#!/bin/bash

# script to create default private ACL records for all the service analyzer home_views of the users in the list

# steps:
# retieve the list of home_views, check the _key in https://localhost:8089/servicesNS/nobody/SA-ITOA/storage/collections/data/itsi_service_analyzer
# store the list in the array_of_sa_ids
#format
#declare -a array_of_sa_ids=("aaa" "bbb" "ccc")
# update host and splunkd port
# use admin user password


splunkhost=localhost:8089
adminpassword="Chang3d!"



#for Case 1638847
declare -a array_of_sa_ids=("105039256" "105041799" "120003139" "200018017" "204035619" "204047631" "204055689" "204070238" "204072028" "208005719" "208011212" "208014516" "208043891" "208043895" "208043906" "210048408" "212040597" "212063171" "212066255" "212066820" "212068247" "212071673" "212305564" "212306882" "212312391" "212319607" "212321984" "212331612" "212337645" "212340705" "212340951" "212340998" "212341176" "212356793" "212360327" "212360610" "212362240" "212367090" "212368446" "212369537" "212392192" "212392748" "212393508" "212393861" "212393863" "212397244" "212397779" "212401223" "212401467" "212405632" "212406803" "212407282" "212407440" "212409664" "212413477" "212417567" "212419187" "212421690" "212426417" "212429521" "212430452" "212432041" "212434874" "212437040" "212437077" "212437180" "212437243" "212438472" "212440163" "212441280" "212442629" "212443465" "212445102" "212448111" "212457652" "212461647" "212464738" "212465126" "212465194" "212466410" "212466755" "212472308" "212472996" "212475823" "212480810" "212481054" "212482360" "212482419" "212483618" "212487844" "212488174" "212545192" "212546370" "212547151" "212550758" "212551186" "212552092" "212552964" "212553193" "212553658" "212555287" "212556690" "212556808" "212559554" "212560038" "212560649" "212560722" "212561174" "212561830" "212562195" "212563695" "212564090" "212564806" "212564816" "212565223" "212565244" "212567095" "212567777" "212568475" "212569081" "212569270" "212570144" "212570158" "212570534" "212571071" "212571344" "212571345" "212571471" "212572524" "212572561" "212572990" "212573235" "212573896" "212574135" "212574153" "212574453" "212575277" "212575497" "212575887" "212576421" "212577731" "212580378" "212581019" "212581213" "212581374" "212581746" "212583262" "212584636" "212585399" "212586456" "212586480" "212587375" "212587924" "212587926" "212587927" "212587932" "212587935" "212587938" "212587943" "212587944" "212587946" "212587950" "212587954" "212587959" "212587966" "212587978" "212587979" "212587981" "212587991" "212588001" "212588013" "212588032" "212588042" "212588046" "212588058" "212588070" "212588074" "212588075" "212588081" "212588083" "212588084" "212588085" "212588087" "212588092" "212588095" "212588097" "212588101" "212588104" "212588128" "212588143" "212588146" "212588147" "212588151" "212588158" "212588163" "212588167" "212588171" "212588172" "212588173" "212588174" "212588181" "212588192" "212588197" "212588207" "212588223" "212588224" "212588228" "212588229" "212588237" "212588242" "212588274" "212588278" "212588279" "212588288" "212588293" "212588295" "212588298" "212588299" "212588303" "212588305" "212588318" "212588321" "212588733" "212589402" "212589451" "212589856" "212592068" "212592088" "212593408" "212595563" "212595928" "212595940" "212595964" "212595970" "212595976" "212595992" "212596561" "212597032" "212597134" "212598629" "212601220" "212601924" "212602153" "212603342" "212605158" "212605508" "212608109" "212608111" "212608278" "212609211" "212611170" "212611438" "212611900" "212613222" "212614203" "212614205" "212614511" "212615825" "212615857" "212616013" "212616039" "212616474" "212616551" "212616565" "212616857" "212629044" "212629046" "212629051" "212629666" "212632019" "212632867" "212633614" "212633899" "212633924" "212634637" "212634641" "212634648" "212634842" "212634865" "212634997" "212635217" "212635452" "212635628" "212635931" "212636382" "212636384" "212637271" "212668607" "212668817" "212668828" "212669100" "212670307" "212670656" "212675414" "212675666" "212676403" "212676410" "212677395" "212677396" "212677400" "212677511" "212677906" "212677963" "212680593" "212680899" "212680901" "212681091" "212681094" "212681490" "212682457" "212682668" "212684667" "212685235" "212686136" "212686318" "212687344" "212687453" "212688897" "212691113" "212691787" "212691790" "212691797" "212691930" "212691950" "212692276" "212692845" "212693258" "212693810" "212694333" "212696079" "212698268" "212698270" "212699069" "212699070" "212699536" "212702286" "212702585" "212703364" "212703846" "212703906" "212704079" "212704086" "212710515" "212710647" "212710810" "212713265" "212713433" "212716456" "212717975" "212718780" "212722171" "212725626" "212727892" "212729715" "212730028" "212732444" "212733228" "212735657" "212737418" "212739262" "212740776" "212742619" "212744475" "212746700" "212747498" "212750606" "212756555" "212758244" "212758475" "212762808" "212771083" "212771156" "212772527" "212774538" "212775642" "212776518" "212785891" "212787008" "218024179" "218024183" "218024206" "218024208" "218024216" "218024219" "218024220" "218024247" "218024862" "305014651" "307009123" "410002083" "502332669" "502353795" "502391487" "502577112" "502587283" "502589691" "502616003" "502633387" "502710906" "502751666" "502751668" "502773040" "503005046" "503039518" "503040644" "503043267" "503058810" "503059595" "503085464" "503092955" "503092962" "503103166" "503108813" "503118124" "503122417" "503124717" "503155845" "5be098f35d30cf73034b2b11" "5ca68c9ff14c041103506a09" "5d83f9794c4ffc2e81592d5a" "5dad43bc4c4ffc624427e50e" "5e177a35f14c0462614d9835" "admin" "itsi_user" "itsinoc" "itsitestuser")

echo "run script for ACL creation "
echo ''

  for sa_id in "${array_of_sa_ids[@]}"
  do
  	acl_id=${sa_id}"-acl"  
	curl -k -u admin:$adminpassword https://${splunkhost}/servicesNS/nobody/SA-UserAccess/storage/collections/data/app_acl -H "Content-Type: application/json" -X POST -d '{"acl_id":"'${acl_id}'","obj_acl":{"obj_owner":"nobody","write":["*"],"delete":["*"],"read":["*"]},"obj_shared_by_inclusion":true,"obj_type":"home_view","obj_id":"'${sa_id}'","acl_owner":"nobody","obj_app":"itsi","obj_storename":"itsi_service_analyzer","_user":"nobody","_key":"'${acl_id}'"}'
	echo ''
  done
